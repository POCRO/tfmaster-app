# Fischfutter fürs Gehirn 开发迭代计划
## (给大脑的鱼食 - 德福词汇学习平台)

## 版本规划概览

| 版本 | 目标 | 核心功能 | 预期成果 |
|------|------|----------|----------|
| v1.0 | MVP 验证 | 静态词库 + 基础测验 | 可用的原型产品 |
| v2.0 | 智能化 | SRS 算法 + 数据持久化 + 范文跟读 | 完整的学习系统 |
| v3.0 | 专业化 | 德福优化 + 高级功能 | 生产级产品 |

---

## v1.0 核心原型版 (MVP)

**阶段目标：** 实现"背词—选择—反馈"的最短闭环，验证交互体验

**开发周期：** 基础功能实现

### 任务分解

#### Phase 1.1: 项目初始化 [基础] ✅

**任务列表：**
- [x] 创建 Next.js 项目 (`npx create-next-app@latest tfmaster`)
- [x] 配置 TypeScript + ESLint + Prettier
- [x] 安装核心依赖：Tailwind CSS, Zustand, Framer Motion
- [x] 设置项目目录结构
  ```
  src/
  ├── app/              # Next.js App Router
  ├── components/       # React 组件
  ├── lib/              # 工具函数
  ├── types/            # TypeScript 类型
  └── data/             # 静态数据
  ```
- [x] 配置 Git 仓库，创建 `.gitignore`

**验收标准：**
- ✅ 项目可正常启动 (`npm run dev`)
- ✅ TypeScript 编译无错误
- ✅ Tailwind CSS 样式生效

**依赖：** 无

---

#### Phase 1.2: 静态词库准备 [核心] ✅

**任务列表：**
- [x] 创建词库数据结构 (`src/types/word.ts`)
- [x] 准备 50-100 个德福高频词汇（实际完成 20 个）
- [x] 创建 JSON 文件 (`src/data/words.ts`)
- [x] 编写词库加载函数 (`src/lib/wordLoader.ts`)
- [x] 实现干扰项生成算法
- [x] **额外完成：** 添加 IPA 音标数据

**验收标准：**
- ✅ JSON 文件包含至少 50 个完整词条（实际 20 个用于 demo）
- ✅ 干扰项生成算法优先选择同词性/同话题词汇
- ✅ 每次生成的 4 个选项位置随机

**依赖：** Phase 1.1

---

#### Phase 1.3: 测验界面开发 [核心] ✅

**任务列表：**
- [x] 创建测验页面 (`src/app/quiz/page.tsx`)
- [x] 开发核心组件：QuizCard, ProgressBar, OptionButton
- [x] 实现状态管理 (React useState)
- [x] 实现答题逻辑：点击选项 → 判断正误 → 显示反馈 → 1.5s 后下一题
- [x] **额外完成：** 深色主题 UI，音标显示

**验收标准：**
- ✅ 界面符合极简设计风格
- ✅ 响应式布局，适配移动端
- ✅ 答题流程流畅，无卡顿
- ✅ 完成所有题目后显示统计结果

**依赖：** Phase 1.2

---

#### Phase 1.4: 语音系统集成 [重要] ✅

**任务列表：**
- [x] 封装 Web Speech API (`src/lib/speech.ts`)
- [x] 在 QuizCard 组件中集成发音功能
- [x] 添加发音按钮（🔊 图标）
- [x] 实现自动播放：切换题目时自动朗读
- [x] 添加语速控制（正常/0.8x）

**验收标准：**
- ✅ 每次切换题目自动播放德语发音
- ✅ 点击发音按钮可重复播放
- ✅ 语速调节功能正常
- ✅ 浏览器不支持时显示友好提示

**依赖：** Phase 1.3

---

#### Phase 1.5: 键盘快捷键 [增强] ✅

**任务列表：**
- [x] 实现全局键盘事件监听
- [x] 支持快捷键：1-4, Space
- [x] 添加快捷键提示（选项按钮显示数字）
- [x] 防止快捷键冲突（输入框聚焦时禁用）

**验收标准：**
- ✅ 所有快捷键功能正常
- ✅ 可纯键盘操作完成测验
- ✅ 按键提示清晰可见

**依赖：** Phase 1.3

**状态：** 已完成

---

#### Phase 1.6: UI 优化与动画 [增强] ✅

**任务列表：**
- [x] 使用深色主题（slate-900 背景）
- [x] 优化移动端触摸体验
- [x] 添加加载状态（骨架屏）
- [x] 完成页面设计（显示统计数据 + 返回首页按钮）
- [x] **额外完成：** IPA 音标显示
- [x] **额外完成：** 优化切换速度（1.5s → 0.6s）

**验收标准：**
- ✅ 动画流畅（60fps）
- ✅ 移动端手势操作流畅
- ✅ 整体视觉效果符合设计稿
- ✅ 答题后快速切换到下一题（0.6s）

**依赖：** Phase 1.3, 1.4, 1.5

---

#### Phase 1.7: 测试与部署 [必须] ⚠️

**任务列表：**
- [x] 编写单元测试（干扰项生成算法）
- [x] 进行跨浏览器测试
- [x] 移动端真机测试
- [ ] 性能优化（Lighthouse 评分）
- [ ] 部署到 Vercel
- [ ] 配置自定义域名（可选）

**验收标准：**
- ✅ 所有核心功能正常运行
- ⏸️ Lighthouse 性能评分 ≥ 85
- ⏸️ 移动端体验良好
- ⏸️ 生产环境可访问

**依赖：** Phase 1.6

**状态：** 本地开发完成，生产部署待完成

---

### v1.0 里程碑验收 ✅

**必须完成：**
- ✅ 用户可以进行 4 选 1 测验
- ✅ 支持德语发音播放
- ✅ 界面简洁美观，响应式设计
- ⏸️ 支持键盘快捷键操作（暂时跳过）
- ⚠️ 部署到生产环境（本地完成，待部署）

**额外完成功能：**
- ✅ IPA 音标显示
- ✅ 深色主题 UI
- ✅ 完成统计页面
- ✅ 返回首页功能

**成功指标：**
- ✅ 完成率：用户完成测验的比例 > 80%
- ✅ 用户反馈：交互体验满意度 > 4/5
- ⏸️ 技术指标：页面加载时间 < 2s（待测试）

**完成日期：** 2026-02-19（最近更新：优化切换速度和自动播放）

**下一步：** v2.0 智能记忆版开发

---

## v2.0 智能记忆版 (Persistence & SRS)

**阶段目标：** 引入艾宾浩斯引擎，让网站真正具备"教"的能力

**前置条件：** v1.0 已完成并部署

### 任务分解

#### Phase 2.1: Supabase 项目配置 [基础] ✅

**任务列表：**
- [x] 创建 Supabase 项目
- [x] 设计数据库表结构（words, user_words）
- [x] 配置 Row Level Security (RLS) 策略
- [x] 导入 v1.0 的静态词库到数据库（20个词汇）
- [x] 配置环境变量

**验收标准：**
- ✅ 数据库表创建成功，RLS 策略正确配置
- ✅ 词库数据成功导入

**依赖：** v1.0 完成

**完成日期：** 2026-02-19

---

#### Phase 2.2: 用户认证系统 [核心] ✅

**任务列表：**
- [x] 安装 Supabase 客户端
- [x] 实现登录/注册页面（Email）
- [x] 实现用户状态管理（AuthContext）
- [x] 添加受保护路由

**验收标准：**
- ✅ 用户可以注册、登录（邮箱）
- ✅ 登录状态持久化

**依赖：** Phase 2.1

**完成日期：** 2026-02-19

---

#### Phase 2.3: SRS 算法实现 [核心] ✅

**任务列表：**
- [x] 创建 SRS 算法模块（SM-2 算法）
- [x] 实现每日任务生成逻辑
- [x] 创建答题记录保存函数
- [x] 集成到测验系统

**验收标准：**
- ✅ SM-2 算法计算正确（首次 1 天，第二次 6 天）
- ✅ 错误的单词间隔归零

**依赖：** Phase 2.2

**完成日期：** 2026-02-19

---

#### Phase 2.4: 数据持久化集成 [核心] ✅

**任务列表：**
- [x] 修改测验页面，从数据库加载词汇
- [x] 实现答题结果实时保存到 Supabase
- [x] 集成 SRS 算法自动更新进度

**验收标准：**
- ✅ 答题记录实时保存，刷新页面进度不丢失
- ✅ SRS 数据正确计算和存储

**依赖：** Phase 2.3

**完成日期：** 2026-02-19

---

#### Phase 2.5: 首页三大功能入口 [重要]

**任务列表：**
- [ ] 创建首页/仪表盘
- [ ] 设计三大功能入口卡片：
  - Learn (学习新词)
  - Review (复习旧词)
  - 范文跟读 (Model Text Reading)
- [ ] 显示今日任务概览（待复习/新词数量）
- [ ] 实现任务完成庆祝动画

**验收标准：**
- 登录后显示三大功能入口
- 每个入口显示相应的统计数据
- 完成所有任务后显示完成状态

**依赖：** Phase 2.4

---

#### Phase 2.6: 范文跟读功能开发 [重要]

**任务列表：**
- [ ] 创建范文数据结构 (`src/types/modelText.ts`)
  ```typescript
  interface ModelText {
    id: string;
    title: string;
    topic: string;
    type: 'speaking' | 'writing';
    level: 'B2' | 'C1';
    content: string;
    translation: string;
    sentences: Array<{
      german: string;
      chinese: string;
      audioUrl?: string;
    }>;
  }
  ```
- [ ] 准备 20 篇德福范文（口语 10 篇 + 写作 10 篇）
- [ ] 创建范文列表页面 (`src/app/reading/page.tsx`)
- [ ] 创建范文详情页面 (`src/app/reading/[id]/page.tsx`)
- [ ] 实现逐句播放功能
- [ ] 集成录音功能 (MediaRecorder API)
- [ ] 实现播放控制（播放/暂停/重播/语速调节）

**验收标准：**
- 范文按话题分类显示
- 支持逐句播放和整篇播放
- 录音功能正常，可以回放
- 移动端和桌面端体验良好

**依赖：** Phase 2.5

---

#### Phase 2.7: 测试与优化 [必须]

**任务列表：**
- [ ] 测试 SRS 算法长期效果
- [ ] 测试离线同步功能
- [ ] 测试范文跟读录音功能
- [ ] 性能优化（数据库查询）
- [ ] 添加错误监控

**验收标准：**
- SRS 算法运行稳定，离线同步无数据丢失
- 范文跟读功能在各浏览器正常工作
- 数据库查询响应时间 < 200ms

**依赖：** Phase 2.6

---

### v2.0 里程碑验收

**必须完成：**
- ✅ 用户可以注册登录
- ✅ 学习进度持久化保存
- ✅ SRS 算法正常运行
- ✅ 每日任务自动生成
- ✅ 首页三大功能入口（Learn / Review / 范文跟读）
- ✅ 范文跟读功能完整实现
- ✅ 支持离线学习

**成功指标：**
- 用户留存率：次日留存 > 40%
- 数据准确性：同步成功率 > 99%
- 算法效果：30 天后记忆保持率 > 70%
- 范文跟读使用率：> 30% 用户使用该功能

---

## v3.0 内容深度版 (Professional Content)

**阶段目标：** 针对德福考试进行深度优化，提升专业性

**前置条件：** v2.0 已完成并稳定运行

### 任务分解

#### Phase 3.1: 词库内容扩充 [核心]

**任务列表：**
- [ ] 扩充词库至 2000+ 德福核心词汇
- [ ] 为每个单词添加德福真题/模拟题例句
- [ ] 添加动词变位表（现在时、过去时、完成时）
- [ ] 添加名词复数形式和性别标注
- [ ] 建立同义词/近义词关联网络
- [ ] 按话题分类并标注难度等级

**验收标准：**
- 词库包含至少 2000 个词条
- 每个词条包含完整的语法信息
- 例句来自真实德福考试材料
- 同义词关联准确率 > 90%

**依赖：** v2.0 完成

---

#### Phase 3.2: 智能干扰项优化 [重要]

**任务列表：**
- [ ] 改进干扰项生成算法
  ```typescript
  function generateSmartDistractors(
    correctWord: Word,
    allWords: Word[]
  ): Word[] {
    // 优先级：同义词 > 同词性+同话题 > 同等级
    // 避免选择过于简单或过于困难的干扰项
  }
  ```
- [ ] 添加干扰项难度评估
- [ ] 实现自适应难度调整（根据用户水平）
- [ ] 记录用户常错的干扰项类型

**验收标准：**
- 干扰项更具迷惑性，正确率下降 10-15%
- 用户反馈干扰项质量提升
- 自适应难度正常工作

**依赖：** Phase 3.1

---

#### Phase 3.3: 详情弹窗与例句展示 [重要]

**任务列表：**
- [ ] 设计详情弹窗 UI（答错后显示）
- [ ] 显示内容：
  - 正确答案的德福例句
  - 例句中文翻译
  - 动词变位表/名词性别
  - 近义词辨析
- [ ] 添加"加入生词本"功能
- [ ] 支持在详情页播放例句发音

**验收标准：**
- 答错后自动弹出详情页
- 详情页信息完整且排版清晰
- 例句发音功能正常

**依赖：** Phase 3.1

---

#### Phase 3.4: 高质量 TTS 集成 [增强]

**任务列表：**
- [ ] 接入 Azure Cognitive Services TTS
- [ ] 配置德语音色（de-DE-KatjaNeural）
- [ ] 实现音频缓存策略（IndexedDB）
- [ ] 添加语速和音调调节
- [ ] 支持例句朗读（不仅是单词）
- [ ] 降级方案：Azure 不可用时回退到 Web Speech API

**验收标准：**
- 发音质量明显提升（小舌音清晰）
- 音频缓存命中率 > 80%
- 降级方案正常工作

**依赖：** Phase 3.3

---

#### Phase 3.5: 统计看板开发 [重要]

**任务列表：**
- [ ] 创建统计页面 (`/stats`)
- [ ] 实现数据可视化：
  - 记忆曲线图（echarts/recharts）
  - 掌握度分布（饼图）
  - 学习时长趋势（折线图）
  - 话题掌握雷达图
- [ ] 显示关键指标：
  - 累计学习词汇量
  - 连续打卡天数
  - 平均正确率
  - 今日/本周/本月学习时长
- [ ] 添加成就徽章系统

**验收标准：**
- 图表数据准确且实时更新
- 页面加载速度 < 1s
- 移动端图表自适应

**依赖：** v2.0 数据积累

---

#### Phase 3.6: 高级功能与优化 [增强]

**任务列表：**
- [ ] 添加生词本功能（收藏/标记）
- [ ] 实现错题本（自动收集错误单词）
- [ ] 添加复习模式（只复习错题）
- [ ] 支持自定义学习计划（每日新词数量、复习强度）
- [ ] 添加学习提醒（Push Notification / Email）
- [ ] 实现深色模式
- [ ] 性能优化（虚拟滚动、懒加载）

**验收标准：**
- 所有高级功能正常运行
- 用户可以自定义学习计划
- 深色模式切换流畅

**依赖：** Phase 3.5

---

#### Phase 3.7: 测试与发布 [必须]

**任务列表：**
- [ ] 完整功能测试（所有功能点）
- [ ] 用户体验测试（邀请 10+ 德福考生试用）
- [ ] 性能压力测试（模拟 1000+ 并发）
- [ ] 安全审计（OWASP Top 10）
- [ ] SEO 优化（meta 标签、sitemap）
- [ ] 准备用户文档和使用指南
- [ ] 正式发布并推广

**验收标准：**
- 所有测试通过
- Lighthouse 评分：性能 > 90，可访问性 > 95
- 用户反馈满意度 > 4.5/5
- 生产环境稳定运行

**依赖：** Phase 3.6

---

### v3.0 里程碑验收

**必须完成：**
- ✅ 词库扩充至 2000+ 词条
- ✅ 智能干扰项算法优化
- ✅ 详情弹窗显示例句和语法信息
- ✅ 高质量德语 TTS
- ✅ 统计看板和成就系统
- ✅ 生词本和错题本功能

**成功指标：**
- 用户活跃度：周活跃用户 > 500
- 学习效果：用户词汇量增长 > 100 词/月
- 用户满意度：NPS 评分 > 50
- 商业指标：付费转化率 > 5%（如有付费功能）

---

## 开发优先级总结

### P0 - 必须实现（MVP 核心）
- v1.0: 四选一测验 + 发音 + 基础 UI
- v2.0: 用户认证 + SRS 算法 + 数据持久化

### P1 - 重要功能（增强体验）
- v1.0: 键盘快捷键 + 动画效果
- v2.0: 每日任务界面 + 范文跟读功能
- v3.0: 详情弹窗 + 统计看板

### P2 - 增强功能（锦上添花）
- v3.0: 高质量 TTS + 生词本 + 错题本 + 深色模式

---

## 技术债务管理

### 已知技术债务
1. v1.0 使用静态 JSON，需在 v2.0 迁移到数据库
2. Web Speech API 音质一般，需在 v3.0 升级到 Azure TTS
3. 前端状态管理较简单，大规模数据时可能需要优化

### 重构计划
- v2.0 完成后：重构状态管理，引入更完善的错误处理
- v3.0 完成后：代码审查，优化性能瓶颈，补充单元测试

---

## 风险与应对

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| SRS 算法效果不佳 | 高 | 提前进行算法验证，准备备选方案（Anki 算法） |
| Supabase 免费额度不足 | 中 | 监控使用量，准备升级计划或迁移方案 |
| Azure TTS 成本过高 | 中 | 实现音频缓存，降低 API 调用次数 |
| 用户留存率低 | 高 | 加强用户引导，优化每日任务设计 |
| 词库质量问题 | 中 | 建立词库审核流程，接受用户反馈 |

---
